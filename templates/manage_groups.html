{% extends "base.html" %}

<!------------Manage Groups Title----------->
{% block title %}Manage Groups - Blog App{% endblock %}

<!------------Style link-------------------->
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/manage_groups.css') }}">
{% endblock %}

<!------------Content Blocks---------------->
{% block content %}
<div class="gradient-admin">
    <!-- Background Gradients -->
    <div class="gradient-left"></div>
    <div class="gradient-right"></div>
    
    <!-- Header -->
    <div class="simple-header">
        <h1>Group Manager</h1>
        <p>Organize your blog posts into groups</p>
        <a href="{{ url_for('admin') }}" class="back-to-admin-btn">
            ‚Üê Back to Admin
        </a>
    </div>

    <!-- Create New Group Form -->
    <div class="form-card">
        <h2 class="card-title">Create New Group</h2>
        <form method="POST" action="{{ url_for('create_group') }}" class="clean-form">
            <div class="input-group">
                <input type="text" id="group_name" name="group_name" class="clean-input" placeholder=" " required>
                <label for="group_name" class="input-label">Group Name</label>
            </div>
            <div class="input-group">
                <textarea id="group_description" name="group_description" rows="2" class="clean-textarea" placeholder=" "></textarea>
                <label for="group_description" class="input-label">Group Description (Optional)</label>
            </div>
            <button type="submit" class="submit-btn">
                <span>Create Group</span>
            </button>
        </form>
    </div>

    <!-- Quick Add Posts to Groups Section -->
    {% if blogs and groups %}
    <div class="bulk-section">
        <div class="section-header">
            <h2>Quick Add Posts to Groups</h2>
            <span class="post-count">{{ blogs|length }} posts available</span>
        </div>
        
        <div class="bulk-interface">
            <!-- Search and Selection Area -->
            <div class="selection-area">
                <div class="search-controls">
                    <input type="text" id="blogSearch" class="search-input" placeholder="Search posts...">
                    <button type="button" id="toggleShowBtn" class="toggle-show-btn">Hide All</button>
                </div>
                
                <div class="selection-controls">
                    <button type="button" id="selectAllBtn" class="selection-control-btn select-all">Select All</button>
                    <button type="button" id="deselectAllBtn" class="selection-control-btn deselect-all">Deselect All</button>
                </div>
                
                <div class="blogs-checkbox-container">
                    <div class="blogs-checkbox-grid" id="blogsGrid">
                        {% for blog_id, blog in blogs.items() %}
                        {% if blog and blog.title %}
                        <div class="blog-checkbox-item" data-blog-title="{{ blog.title|lower }}">
                            <input type="checkbox" id="blog_{{ blog_id }}" name="blog_ids" value="{{ blog_id }}" class="blog-checkbox">
                            <label for="blog_{{ blog_id }}" class="blog-checkbox-label">{{ blog.title }}</label>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Selected Posts Area -->
            <div class="selected-area" id="selectedArea" style="display: none;">
                <h3>Selected Posts <span class="selected-count">(0)</span></h3>
                <div class="selected-list-container">
                    <div class="selected-list" id="selectedList">
                        <!-- Selected blogs will appear here -->
                    </div>
                </div>
                
                <div class="group-selection">
                    <h4>Add to Group:</h4>
                    <div class="group-buttons" data-bulk-add-url="{{ url_for('add_multiple_blogs_to_group') }}">
                        {% for group_id, group in groups.items() %}
                        <button type="button" class="group-add-btn" data-group-id="{{ group_id }}">
                            {{ group.name }}
                        </button>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Existing Groups -->
    <div class="groups-section">
        <div class="section-header">
            <h2>Existing Groups</h2>
            <span class="post-count">{{ groups|length }} groups</span>
        </div>

        {% if groups %}
        <div class="groups-grid">
            {% for group_id, group in groups.items() %}
                <div class="group-card">
                    <div class="group-header-section">
                        <h3>
                            {{ group.name }}
                            {% if group.hidden %}
                            <span class="group-hidden-badge">üîí Hidden</span>
                            {% endif %}
                        </h3>
                        <div class="group-actions">
                            <!-- Hide/Show Group Button -->
                            <a href="{{ url_for('toggle_group_visibility', group_id=group_id) }}" 
                            class="group-visibility-btn {% if group.hidden %}show-group{% else %}hide-group{% endif %}">
                                {% if group.hidden %}
                                    üëÅÔ∏è Show Group
                                {% else %}
                                    üôà Hide Group
                                {% endif %}
                            </a>
                            <a href="{{ url_for('delete_group', group_id=group_id) }}" 
                            class="btn btn-danger"
                            onclick="return confirm('Delete this group?')">
                                üóëÔ∏è Delete Group
                            </a>
                        </div>
                    </div>
                    
                    {% if group.description %}
                    <p class="group-description">{{ group.description }}</p>
                    {% endif %}
                    
                    <!-- Rest of your group content -->
                    <div class="group-blogs">
                        <h4>Blogs in this group ({{ group.blogs|length }}):</h4>
                        {% if group.blogs %}
                            <ul class="blog-list-in-group">
                                {% for blog_id in group.blogs %}
                                    {% if blog_id in blogs %}
                                    <li>
                                        {{ blogs[blog_id].title }}
                                        {% if blogs[blog_id].hidden %}
                                        <span class="hidden-badge">üîí</span>
                                        {% endif %}
                                        <form method="POST" action="{{ url_for('remove_blog_from_group') }}" style="display: inline;">
                                            <input type="hidden" name="group_id" value="{{ group_id }}">
                                            <input type="hidden" name="blog_id" value="{{ blog_id }}">
                                            <button type="submit" class="btn-remove">Remove</button>
                                        </form>
                                    </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="no-blogs">No blogs in this group yet.</p>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üìÅ</div>
            <h3>No groups yet</h3>
            <p>Create your first group to organize blog posts</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

<!-----------JS Link------------------------>
{% block extra_js %}
<script src="{{ url_for('static', filename='js/manage_groups.js') }}"></script>
{% endblock %}