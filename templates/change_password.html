{% extends "base.html" %}

{% block title %}Change Password - Blog App{% endblock %}

{% block extra_css %}
<style>
    .password-container {
        max-width: 600px;
        margin: 3rem auto;
        background: white;
        border-radius: 20px;
        padding: 3rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    .password-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .password-header h1 {
        font-size: 2rem;
        color: #1a202c;
        margin-bottom: 0.5rem;
    }

    .password-header p {
        color: #718096;
    }

    .alert {
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        animation: slideDown 0.3s ease;
    }

    .alert-error {
        background: #fee;
        color: #c53030;
        border: 1px solid #fc8181;
    }

    .alert-success {
        background: #f0fdf4;
        color: #166534;
        border: 1px solid #86efac;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #2d3748;
        font-weight: 600;
    }

    .input-wrapper {
        position: relative;
    }

    .form-control {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .password-strength {
        margin-top: 0.5rem;
        height: 4px;
        background: #e2e8f0;
        border-radius: 2px;
        overflow: hidden;
    }

    .password-strength-bar {
        height: 100%;
        width: 0;
        transition: all 0.3s ease;
    }

    .btn-submit {
        width: 100%;
        padding: 1rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .btn-cancel {
        width: 100%;
        padding: 1rem;
        background: #e2e8f0;
        color: #2d3748;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 1rem;
        text-decoration: none;
        display: block;
        text-align: center;
    }

    .btn-cancel:hover {
        background: #cbd5e0;
    }

    .password-requirements {
        background: #f7fafc;
        padding: 1rem;
        border-radius: 10px;
        margin-top: 1.5rem;
        font-size: 0.9rem;
    }

    .password-requirements h4 {
        color: #2d3748;
        margin-bottom: 0.5rem;
    }

    .password-requirements ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .password-requirements li {
        color: #718096;
        padding: 0.25rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .password-requirements li i {
        width: 16px;
    }

    .password-requirements li.valid {
        color: #48bb78;
    }

    .password-requirements li.valid i::before {
        content: "\f00c";
    }

    .password-requirements li i::before {
        content: "\f111";
    }
</style>
{% endblock %}

{% block content %}
<div class="password-container">
    <div class="password-header">
        <h1>ðŸ”’ Change Password</h1>
        <p>Update your admin password for enhanced security</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('change_password') }}" id="passwordForm">
        <div class="form-group">
            <label for="current_password">Current Password</label>
            <input 
                type="password" 
                id="current_password" 
                name="current_password" 
                class="form-control" 
                required
            >
        </div>

        <div class="form-group">
            <label for="new_password">New Password</label>
            <input 
                type="password" 
                id="new_password" 
                name="new_password" 
                class="form-control" 
                required
                minlength="8"
            >
            <div class="password-strength">
                <div class="password-strength-bar" id="strengthBar"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="confirm_password">Confirm New Password</label>
            <input 
                type="password" 
                id="confirm_password" 
                name="confirm_password" 
                class="form-control" 
                required
            >
        </div>

        <div class="password-requirements">
            <h4>Password Requirements:</h4>
            <ul id="requirements">
                <li id="req-length"><i class="fas"></i> At least 8 characters</li>
                <li id="req-uppercase"><i class="fas"></i> One uppercase letter</li>
                <li id="req-lowercase"><i class="fas"></i> One lowercase letter</li>
                <li id="req-number"><i class="fas"></i> One number</li>
                <li id="req-match"><i class="fas"></i> Passwords match</li>
            </ul>
        </div>

        <button type="submit" class="btn-submit" id="submitBtn" disabled>
            Change Password
        </button>
    </form>

    <a href="{{ url_for('admin') }}" class="btn-cancel">Cancel</a>
</div>

<script>
const newPassword = document.getElementById('new_password');
const confirmPassword = document.getElementById('confirm_password');
const strengthBar = document.getElementById('strengthBar');
const submitBtn = document.getElementById('submitBtn');

const requirements = {
    length: /^.{8,}$/,
    uppercase: /[A-Z]/,
    lowercase: /[a-z]/,
    number: /[0-9]/
};

function checkPasswordStrength() {
    const password = newPassword.value;
    let strength = 0;
    let color = '';

    // Check requirements
    document.getElementById('req-length').classList.toggle('valid', requirements.length.test(password));
    document.getElementById('req-uppercase').classList.toggle('valid', requirements.uppercase.test(password));
    document.getElementById('req-lowercase').classList.toggle('valid', requirements.lowercase.test(password));
    document.getElementById('req-number').classList.toggle('valid', requirements.number.test(password));

    // Calculate strength
    Object.values(requirements).forEach(regex => {
        if (regex.test(password)) strength += 25;
    });

    // Set color based on strength
    if (strength <= 25) {
        color = '#ef4444';
    } else if (strength <= 50) {
        color = '#f59e0b';
    } else if (strength <= 75) {
        color = '#3b82f6';
    } else {
        color = '#10b981';
    }

    strengthBar.style.width = strength + '%';
    strengthBar.style.backgroundColor = color;

    checkFormValidity();
}

function checkFormValidity() {
    const password = newPassword.value;
    const confirm = confirmPassword.value;
    
    const allValid = Object.values(requirements).every(regex => regex.test(password));
    const passwordsMatch = password === confirm && password.length > 0;
    
    document.getElementById('req-match').classList.toggle('valid', passwordsMatch);
    
    submitBtn.disabled = !(allValid && passwordsMatch);
}

newPassword.addEventListener('input', checkPasswordStrength);
confirmPassword.addEventListener('input', checkFormValidity);
</script>
{% endblock %}