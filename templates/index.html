{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="layout">
        <!-- Sidebar -->
<!-- Sidebar -->
<!-- Sidebar -->
<aside class="sidebar">
    <h2>Blog Posts</h2>
    
    <!-- Groups Section -->
    {% if groups %}
    <div class="groups-section">
        {% for group_id, group in groups.items() %}
        <div class="group-item">
            <div class="group-header">
                <span class="group-name">{{ group.name }}</span>
                {% if group.blogs %}
                <button class="toggle-btn" onclick="toggleGroup('{{ group_id }}')">
                    <i id="group-icon-{{ group_id }}" class="fas fa-chevron-down"></i>
                </button>
                {% endif %}
            </div>
            {% if group.blogs %}
            <div id="group-content-{{ group_id }}" class="group-content" style="display: none;">
                <div class="blog-list">
                    {% for blog_id in group.blogs %}
                    {% set blog = blogs[blog_id] %}
                    <div class="blog-item">
                        <a href="{{ url_for('blog_detail', blog_id=blog_id) }}" class="blog-title">
                            {{ blog.title }}
                        </a>
                        {% if blog.subsections %}
                        <button class="toggle-btn" onclick="toggleSubsections('{{ blog_id }}')">
                            <i id="icon-{{ blog_id }}" class="fas fa-chevron-down"></i>
                        </button>
                        <div id="subsections-{{ blog_id }}" class="subsections" style="display: none;">
                            {% for subsection in blog.subsections %}
                            <a href="{{ url_for('blog_detail', blog_id=blog_id) }}#subsection-{{ loop.index0 }}"
                               class="subsection-link">
                                {{ subsection.title }}
                            </a>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="group-content" style="display: none;">
                <p class="no-blogs-message">No blogs in this group yet.</p>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Ungrouped Blogs -->
    <div class="ungrouped-blogs">
        <h3>Other Posts</h3>
        <div class="blog-list">
            {% for blog_id, blog in blogs.items() %}
            {% set is_ungrouped = true %}
            {% for group in groups.values() %}
                {% if blog_id in group.blogs %}
                    {% set is_ungrouped = false %}
                {% endif %}
            {% endfor %}
            {% if is_ungrouped %}
            <div class="blog-item">
                <a href="{{ url_for('blog_detail', blog_id=blog_id) }}" class="blog-title">
                    {{ blog.title }}
                </a>
                {% if blog.subsections %}
                <button class="toggle-btn" onclick="toggleSubsections('{{ blog_id }}')">
                    <i id="icon-{{ blog_id }}" class="fas fa-chevron-down"></i>
                </button>
                <div id="subsections-{{ blog_id }}" class="subsections" style="display: none;">
                    {% for subsection in blog.subsections %}
                    <a href="{{ url_for('blog_detail', blog_id=blog_id) }}#subsection-{{ loop.index0 }}"
                       class="subsection-link">
                        {{ subsection.title }}
                    </a>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</aside>

<style>
/* Group Styles for Sidebar */
.groups-section {
    margin-bottom: 1.5rem;
}

.group-item {
    border: 1px solid #d0d7de;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    background: white;
    overflow: hidden;
}

.group-header {
    padding: 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f6f8fa;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.group-header:hover {
    background: #eaeef2;
}

.group-name {
    font-weight: 600;
    color: #24292f;
    font-size: 0.9rem;
}

.toggle-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #656d76;
    font-size: 0.8rem;
    padding: 0.25rem;
    border-radius: 3px;
    transition: color 0.2s ease;
}

.toggle-btn:hover {
    color: #24292f;
    background: rgba(0, 0, 0, 0.05);
}

.group-content {
    padding: 0;
    border-top: 1px solid #d0d7de;
    background: white;
}

.group-content .blog-list {
    padding: 0.5rem;
}

.no-blogs-message {
    padding: 1rem;
    color: #656d76;
    font-style: italic;
    text-align: center;
    margin: 0;
    font-size: 0.9rem;
}

.ungrouped-blogs {
    margin-top: 1.5rem;
}

.ungrouped-blogs h3 {
    font-size: 1rem;
    color: #24292f;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid #d0d7de;
    padding-bottom: 0.25rem;
}

/* Blog item styles */
.blog-item {
    border: 1px solid #d0d7de;
    border-radius: 6px;
    padding: 0.75rem;
    position: relative;
    background: white;
    margin-bottom: 0.5rem;
}

.blog-title {
    color: #0969da;
    text-decoration: none;
    font-weight: 500;
    display: block;
    margin-right: 2rem;
    font-size: 0.9rem;
}

.blog-title:hover {
    text-decoration: underline;
}

.subsections {
    margin-top: 0.5rem;
    padding-left: 0.75rem;
    border-left: 2px solid #d0d7de;
}

.subsection-link {
    display: block;
    color: maroon;
    text-decoration: none;
    padding: 0.25rem 0;
    font-size: 0.85rem;
    font-weight: 600;
}

.subsection-link:hover {
    color: #0969da;
    text-decoration: underline;
}
</style>

<script>
function toggleGroup(groupId) {
    console.log('Toggling group:', groupId); // Debug log
    const content = document.getElementById('group-content-' + groupId);
    const icon = document.getElementById('group-icon-' + groupId);
    
    if (!content || !icon) {
        console.error('Element not found for group:', groupId);
        return;
    }
    
    if (content.style.display === 'block' || content.style.display === '') {
        content.style.display = 'none';
        icon.className = 'fas fa-chevron-down';
    } else {
        content.style.display = 'block';
        icon.className = 'fas fa-chevron-up';
    }
}

function toggleSubsections(blogId) {
    console.log('Toggling subsections for blog:', blogId); // Debug log
    const content = document.getElementById('subsections-' + blogId);
    const icon = document.getElementById('icon-' + blogId);
    
    if (!content || !icon) {
        console.error('Element not found for blog:', blogId);
        return;
    }
    
    if (content.style.display === 'block' || content.style.display === '') {
        content.style.display = 'none';
        icon.className = 'fas fa-chevron-down';
    } else {
        content.style.display = 'block';
        icon.className = 'fas fa-chevron-up';
    }
}

// Add click event to group headers for better UX
document.addEventListener('DOMContentLoaded', function() {
    // Add click event to all group headers
    const groupHeaders = document.querySelectorAll('.group-header');
    groupHeaders.forEach(header => {
        header.addEventListener('click', function(e) {
            // Don't trigger if the click was on the toggle button
            if (!e.target.closest('.toggle-btn')) {
                const groupId = this.querySelector('.toggle-btn')?.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                if (groupId) {
                    toggleGroup(groupId);
                }
            }
        });
    });
});
</script>

<style>
/* Group Styles for Sidebar */
.groups-section {
    margin-bottom: 1.5rem;
}

.group-item {
    border: 1px solid #d0d7de;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    background: white;
}

.group-header {
    padding: 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f6f8fa;
    border-radius: 6px 6px 0 0;
}

.group-name {
    font-weight: 600;
    color: #24292f;
    font-size: 0.9rem;
}

.group-content {
    padding: 0.5rem;
}

.ungrouped-blogs {
    margin-top: 1.5rem;
}

.ungrouped-blogs h3 {
    font-size: 1rem;
    color: #24292f;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid #d0d7de;
    padding-bottom: 0.25rem;
}
</style>

<script>
function toggleGroup(groupId) {
    const content = document.getElementById('group-content-' + groupId);
    const icon = document.getElementById('group-icon-' + groupId);
    if (content.style.display === 'block') {
        content.style.display = 'none';
        icon.className = 'fas fa-chevron-down';
    } else {
        content.style.display = 'block';
        icon.className = 'fas fa-chevron-up';
    }
}

// Keep the existing toggleSubsections function
function toggleSubsections(blogId) {
    const content = document.getElementById('subsections-' + blogId);
    const icon = document.getElementById('icon-' + blogId);
    if (content.style.display === 'block') {
        content.style.display = 'none';
        icon.className = 'fas fa-chevron-down';
    } else {
        content.style.display = 'block';
        icon.className = 'fas fa-chevron-up';
    }
}
</script>

        <!-- Main Content -->
        <main class="main-content">
            <div class="welcome-message">
                <h1>Welcome to the Blog</h1>
                <p>Select a blog post from the sidebar to start reading, or visit the admin panel to create new content.</p>
                <div class="feature-cards">
                    <div class="card">
                        <i class="fas fa-eye"></i>
                        <h3>Read Blogs</h3>
                        <p>Browse through various blog posts and their subsections</p>
                    </div>
                    <div class="card">
                        <i class="fas fa-code"></i>
                        <h3>Markdown Support</h3>
                        <p>All content supports Markdown formatting</p>
                    </div>
                    <div class="card">
                        <i class="fas fa-cog"></i>
                        <h3>Easy Management</h3>
                        <p>Use the admin panel to manage all content</p>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}